sudo apt install wireguard

sudo apt install resolvconf
sudo systemctl enable --now resolvconf.service
# 可选在resolv.conf中配置DNS
echo "nameserver 8.8.8.8" | sudo tee /etc/resolv.conf

sudo apt install dnsmasq
sudo systemctl enable --now dnsmasq
# 测试
dig @127.0.0.1 google.com +short   # 能返回结果即正常


# wg服务器端
sudo vim /etc/wireguard/wg0.conf
[Interface]
Address = 10.0.0.1/24
SaveConfig = false
PostUp = iptables -A FORWARD -i wg0 -j ACCEPT; iptables -A FORWARD -o wg0 -j ACCEPT; iptables -t nat -A POSTROUTING -o 物理网卡名称 -j MASQUERADE
PostDown = iptables -D FORWARD -i wg0 -j ACCEPT; iptables -D FORWARD -o wg0 -j ACCEPT; iptables -t nat -D POSTROUTING -o 物理网卡名称 -j MASQUERADE
ListenPort = 51820
PrivateKey = 服务器私钥
DNS = 8.8.8.8

[Peer]
PublicKey = 客户端公钥
AllowedIPs = 10.0.0.2/32

# wg客户端
[Interface]
PrivateKey = 客户端私钥
Address = 10.0.0.2/32

[Peer]
PublicKey = 服务器公钥
Endpoint = 服务器地址:端口
AllowdIPs = 0.0.0.0,::0/0 # 所有
PersistentKeepalive = 25

# 启动
sudo wg-quick up wg0
# 关闭
sudo wg-quick down wg0
